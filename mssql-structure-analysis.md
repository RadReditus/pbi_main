# Анализ структуры MSSQL базы данных 1С

## Цель
Изучить реальную структуру данных в MSSQL базе для понимания:
- Какие таблицы содержат метаданные (названия полей, документов, справочников)
- Как связаны между собой таблицы
- Какие данные можно извлечь для человеко-читаемого представления

## План исследования

### 1. Системные таблицы метаданных
Нужно найти таблицы, которые содержат:
- Названия полей (`_Fld*` -> читаемые имена)
- Названия таблиц (`_Reference*`, `_Document*` -> читаемые имена)
- Связи между объектами
- Описания полей

### 2. Основные типы таблиц для анализа
- **Справочники** (`_Reference*`) - содержат справочную информацию
- **Документы** (`_Document*`) - содержат документооборот
- **Регистры накопления** (`_AccumRg*`) - содержат периодические данные
- **Перечисления** (`_Enum*`) - содержат значения перечислений

### 3. Ключевые поля для изучения
- `_IDRRef` - ссылки на объекты
- `_Code` - коды объектов
- `_Description` - описания объектов
- `_Fld*` - поля с данными
- `_Version` - версии записей
- `_Marked` - пометки на удаление

## SQL запросы для исследования

### 1. Получение списка всех таблиц
```sql
SELECT 
    TABLE_NAME,
    TABLE_TYPE
FROM INFORMATION_SCHEMA.TABLES 
WHERE TABLE_SCHEMA = 'dbo'
ORDER BY TABLE_NAME;
```

### 2. Поиск таблиц метаданных
```sql
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    DATA_TYPE
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = 'dbo'
    AND (TABLE_NAME LIKE '%Metadata%' 
         OR TABLE_NAME LIKE '%Config%'
         OR TABLE_NAME LIKE '%Schema%')
ORDER BY TABLE_NAME, ORDINAL_POSITION;
```

### 3. Анализ справочников
```sql
-- Получить первые 10 записей из справочников
SELECT TOP 10 * FROM dbo._Reference175;
SELECT TOP 10 * FROM dbo._Reference176;
SELECT TOP 10 * FROM dbo._Reference177;
```

### 4. Анализ документов
```sql
-- Получить первые 10 записей из документов
SELECT TOP 10 * FROM dbo._Document224;
```

### 5. Поиск таблиц с описаниями полей
```sql
-- Поиск таблиц, которые могут содержать метаданные полей
SELECT 
    TABLE_NAME,
    COUNT(*) as COLUMN_COUNT
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = 'dbo'
    AND (COLUMN_NAME LIKE '%Name%' 
         OR COLUMN_NAME LIKE '%Description%'
         OR COLUMN_NAME LIKE '%Title%')
GROUP BY TABLE_NAME
ORDER BY COLUMN_COUNT DESC;
```

### 6. Анализ структуры полей
```sql
-- Получить информацию о полях в основных таблицах
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    DATA_TYPE,
    IS_NULLABLE,
    CHARACTER_MAXIMUM_LENGTH
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = 'dbo'
    AND TABLE_NAME IN ('_Reference175', '_Reference176', '_Document224')
ORDER BY TABLE_NAME, ORDINAL_POSITION;
```

## Ожидаемые результаты

### 1. Таблицы метаданных
Должны найтись таблицы типа:
- `_Metadata*` - метаданные объектов
- `_Config*` - конфигурация
- `_Schema*` - схема базы

### 2. Связи между объектами
- Таблицы связей между справочниками и документами
- Таблицы описаний полей
- Таблицы типов данных

### 3. Человеко-читаемые названия
- Названия справочников и документов
- Названия полей
- Описания объектов

## Следующие шаги

1. Выполнить SQL запросы для получения реальных данных
2. Проанализировать структуру найденных таблиц
3. Определить алгоритм преобразования `_Fld*` в читаемые названия
4. Создать маппинг между техническими именами и человеко-читаемыми
5. Интегрировать это в MSSQL сервис для улучшения читаемости данных

## Примечания

- Все запросы выполняются в режиме чтения
- Не изменяем структуру базы данных
- Фокусируемся на понимании архитектуры данных
- Готовимся к будущему функционалу преобразования данных
