# Тестирование MSSQL базы данных 1С

## Цель
Изучить структуру реальной MSSQL базы данных 1С для понимания:
- Какие таблицы содержат метаданные
- Как связаны между собой объекты
- Как преобразовать технические названия в читаемые

## Файлы для тестирования

### 1. `test-mssql-connection.js`
Простой тест подключения к MSSQL базе.

**Запуск:**
```bash
node test-mssql-connection.js
```

**Требования:**
- Установить переменные окружения в `.env`:
  ```
  MSSQL_SERVER=your_server
  MSSQL_DATABASE=your_database
  MSSQL_USER=your_username
  MSSQL_PASSWORD=your_password
  ```

### 2. `test-mssql-structure.js`
Полный анализ структуры базы данных.

**Запуск:**
```bash
node test-mssql-structure.js
```

**Что анализирует:**
- Список всех таблиц
- Поиск таблиц метаданных
- Анализ справочников
- Анализ документов
- Поиск таблиц с описаниями
- Анализ полей `_Fld*`

### 3. `mssql-structure-analysis.md`
План исследования и SQL запросы.

### 4. `mssql-structure-examples.md`
Примеры ожидаемых данных и алгоритмы преобразования.

## Установка зависимостей

```bash
npm install mssql
```

## Настройка подключения

Создайте файл `.env` в корне проекта:

```env
# MSSQL настройки
MSSQL_SERVER=localhost
MSSQL_DATABASE=your_1c_database
MSSQL_USER=sa
MSSQL_PASSWORD=your_password
MSSQL_PORT=1433
MSSQL_ENCRYPT=false
MSSQL_TRUST_SERVER_CERTIFICATE=true
```

## Ожидаемые результаты

### 1. Таблицы метаданных
Должны найтись таблицы типа:
- `_Metadata*` - метаданные объектов
- `_Config*` - конфигурация
- `_Schema*` - схема базы

### 2. Основные объекты
- **Справочники** (`_Reference*`) - справочная информация
- **Документы** (`_Document*`) - документооборот
- **Регистры** (`_AccumRg*`, `_InfoRg*`) - периодические данные
- **Перечисления** (`_Enum*`) - значения перечислений

### 3. Связи между объектами
- Таблицы связей полей с объектами
- Маппинг технических названий на читаемые
- Связи между справочниками и документами

## Алгоритм преобразования

### Этап 1: Получение метаданных
```javascript
// Найти таблицы метаданных
const metadataTables = await findMetadataTables();

// Получить маппинг полей
const fieldMapping = await getFieldMapping();

// Получить маппинг объектов
const objectMapping = await getObjectMapping();
```

### Этап 2: Преобразование данных
```javascript
// Преобразование полей
_Fld3405RRef -> "ЕдиницаИзмерения"
_Fld14168RRef -> "Контрагент"

// Преобразование ссылок
0x2222222222222222 -> "ООО Ромашка"
0x5555555555555555 -> "Основной склад"
```

### Этап 3: Создание читаемых записей
```javascript
// До преобразования
{
    "_IDRRef": "0x1234567890ABCDEF",
    "_Fld3405RRef": "0x9876543210FEDCBA"
}

// После преобразования
{
    "ID": "0x1234567890ABCDEF",
    "ЕдиницаИзмерения": "шт"
}
```

## Следующие шаги

1. **Выполнить тесты** с реальной базой данных
2. **Найти таблицы метаданных** в конкретной базе
3. **Создать маппинг** полей и объектов
4. **Интегрировать** в MSSQL сервис
5. **Добавить кэширование** для производительности
6. **Создать API** для получения читаемых данных

## Примечания

- Все тесты выполняются в режиме чтения
- Не изменяем структуру базы данных
- Фокусируемся на понимании архитектуры
- Готовимся к будущему функционалу преобразования данных

## Безопасность

- Используйте только чтение данных
- Не выполняйте DDL операции
- Делайте резервные копии перед тестированием
- Проверяйте права доступа пользователя
